
/******************************************************************************
*
*   FILE
*   ----
*   sscSyncTest.c
*
*   History
*   -------
*   2018-08-03   File created
*
*******************************************************************************
*
*   This file is generated by the 'acplt_builder' command
*
******************************************************************************/


#ifndef OV_COMPILE_LIBRARY_syncTest
#define OV_COMPILE_LIBRARY_syncTest
#endif


#include "syncTest.h"
#include "sync.h"

#include "libov/ov_macros.h"
#include "libov/ov_result.h"
#include "libov/ov_path.h"

#include "unity.h"
#include "unity_fixture.h"

#include "ovunity.h"
#include "ovunity_helper.h"

#include "CException.h"

OV_INSTPTR_ovunity_main gpinst;
OV_INSTPTR_sync_sscSync gpobj;
OV_TIME *gpltc;

TEST_GROUP( sscSync);

TEST_SETUP( sscSync) {
	ov_memstack_lock();
	//This is run before EACH TEST
//	ov_string_setvalue(&gpinst->v_start, "PE004");
//	ov_string_set_vecvalue_one(&gpinst->v_recipe, 1, "PE005");
//	gpinst->v_EN = 0;
}

TEST_TEAR_DOWN( sscSync) {
	ov_memstack_unlock();
}

TEST( sscSync, sscSync_one2one) {
	OV_STRING case_path = ovunity_getCasePath(gpinst, "one_to_one");
	ovunity_loadEnv(gpinst, "one_to_one.json", case_path);
	OV_STRING source_path = NULL;
	ov_string_print(&source_path, "%s/source", case_path);

	OV_STRING target_path = NULL;
	ov_string_print(&target_path, "%s/target", case_path);

	ov_string_setvalue(&gpobj->v_path, source_path);
	ov_string_print(&gpobj->v_targetKS, "//localhost:7509/MANAGER%s",
		target_path);

	sync_sscSync_typemethod(Ov_StaticPtrCast(fb_functionblock, gpobj), gpltc);

	TEST_ASSERT_EQUAL(gpobj->v_result, 0);
}

TEST( sscSync, sscSync_paramset) {
	OV_STRING host = "a:75";
	OV_STRING servername = "MANAG";
	OV_STRING path = "/techunit/tech";
	ov_string_print(&gpobj->v_targetKS, "//%s/%s%s", host,
		servername,
		path);
	ov_string_setvalue(&gpobj->v_path, "/TechUnits");
	sync_sscSync_typemethod(Ov_StaticPtrCast(fb_functionblock, gpobj), gpltc);
	TEST_ASSERT_EQUAL_STRING(path, gpobj->p_setVar.v_path);
	TEST_ASSERT_EQUAL_STRING(servername, gpobj->p_setVar.v_server);
	TEST_ASSERT_EQUAL_STRING(host, gpobj->p_setVar.v_host);
	TEST_ASSERT_EQUAL_STRING(gpobj->v_targetKS, gpobj->p_setVar.p_apiSet.v_path);

//	TEST_ASSERT_EQUAL_STRING(hostname, gpobj->p_setVar.p_apiSet);
//TEST_ASSERT_EQUAL_STRING(port,)
//TEST_ASSERT_EQUAL_STRING(servername,)
//TEST_ASSERT_EQUAL_STRING(path,)
}
//
//TEST( sscSync, sscSync_2neighbour) {
//	OV_STRING case_path = ovunity_getCasePath(gpinst, "case_2neighbour_fix");
//	ovunity_loadEnv(gpinst, "2Neighbour.json", case_path);
//	ov_string_setvalue(&gpobj->v_Path, case_path);
//	sync_sscSync_typemethod(Ov_StaticPtrCast(fb_functionblock, gpobj), gpltc);
//
//	//image
//	Gitter_t* gitter = gitterConstruct();
//	OV_INSTPTR_ov_domain ptop = Ov_StaticPtrCast(ov_domain,
//		ov_path_getobjectpointer(case_path, 2));
//	draw_top(gitter, ptop);
//	gitter2png(gitter, "sscSyncTest/case_2neighbour_fix_vis");
//
//	TEST_ASSERT_EQUAL(gpobj->v_result, 0);
//}
//
//TEST( sscSync, sscSync_schieber) {
//	OV_STRING case_path = ovunity_getCasePath(gpinst, "case_schieber");
//	ovunity_loadEnv(gpinst, "schieber.json", case_path);
//	gpobj->v_MAXGAP = 20;
//	ov_string_setvalue(&gpobj->v_Path, case_path);
//	sync_sscSync_typemethod(Ov_StaticPtrCast(fb_functionblock, gpobj), gpltc);
//
//	//image
//	Gitter_t* gitter = gitterConstruct();
//	OV_INSTPTR_ov_domain ptop = Ov_StaticPtrCast(ov_domain,
//		ov_path_getobjectpointer(case_path, 2));
//	draw_top(gitter, ptop);
//	gitter2png(gitter, "sscSyncTest/case_schieber_vis");
//
//	TEST_ASSERT_EQUAL(gpobj->v_result, 0);
//}
//
//TEST(sscSync, sscSync_badstart){
//	ov_string_setvalue(&gpinst->v_start, "PE0033");
//	sync_sscSync_typemethod(Ov_StaticPtrCast(fb_functionblock, gpinst), gpltc);
//	TEST_ASSERT_EQUAL(gpinst->v_result, 4);
//}
//	//test2 bad top
//TEST(sscSync, sscSync_badtopo){
////	ov_logfile_info("test: bad topo");
//	ov_string_setvalue(&gpinst->v_topologie, "PE03");
//	sync_sscSync_typemethod(Ov_StaticPtrCast(fb_functionblock, gpinst), gpltc);
//	TEST_ASSERT_EQUAL(gpinst->v_result, 4);
//}
//

TEST_GROUP_RUNNER( sscSync) {
	RUN_TEST_CASE(sscSync, sscSync_one2one);
//	RUN_TEST_CASE(sscSync, sscSync_paramset);
//	RUN_TEST_CASE(sscSync, sscSync_schieber);
//  RUN_TEST_CASE(sscSync, sscSync_badstart);
//  RUN_TEST_CASE(sscSync, sscSync_badtopo);
//  RUN_TEST_CASE(sscSync, sscSync_start_same_end);
//  RUN_TEST_CASE(sscSync, sscSync_heat_turn);
//  RUN_TEST_CASE(sscSync, sscSync_heat2_turn2);
//  RUN_TEST_CASE(sscSync, AnotherIgnoredTest);
//  RUN_TEST_CASE(sscSync, ThisFunctionHasNotBeenTested_NeedsToBeImplemented);
}

static void RunAllTests(void) {
	RUN_TEST_GROUP(sscSync);
}

OV_DLLFNCEXPORT void syncTest_sscSyncTest_typemethod(

OV_INSTPTR_fb_functionblock pfb,

OV_TIME *pltc) {
	/*
	 *   local variables
	 */
	gpinst = Ov_StaticPtrCast(ovunity_main, pfb);
	gpobj = &Ov_StaticPtrCast(syncTest_sscSyncTest, gpinst)->p_obj;
	gpltc = pltc;

	const char* argv[] = { "sscSync", "-v" };
	CEXCEPTION_T e;
	Try
	{
		UnityMain(2, argv, RunAllTests);
	}
	Catch(e)
	{
		ov_logfile_error("sscSyncTest fail");
	}
	return;
}
